# Single-Screen-Desktop (AutoHotkey v2)

### 🚀 仅针对当前显示器显示桌面（多屏协同深度优化版）

---

## 📖 项目简介
**Single-Screen-Desktop** 是一款专为多显示器工作流设计的窗口管理工具。它解决了 Windows 原生 `Win + D` 快捷键会强制最小化所有屏幕窗口的痛点，实现了**基于鼠标位置的局部桌面切换**。

该项目针对多屏环境下的“坐标偏移”和“焦点自动跳转”等底层逻辑进行了深度优化，确保在复杂的办公环境下拥有原生般的操作手感。

---

## 💡 为什么需要它？（解决痛点）
在多屏办公场景中，原生的全局最小化往往会中断工作流：

* **参考对照**：在屏幕 A 查阅技术文档，想清空屏幕 B 开始编码。原生快捷键会导致 A 屏的资料一并消失。
* **演示与会议**：正在屏幕 A 进行投屏分享，需要临时回到桌面查找文件，但不希望屏幕 B 的私人聊天窗口被观众看到。
* **专注模式**：某个屏幕堆积了太多临时文件夹，只想清空这一个区域进行整理，而不愿打断另一个屏幕正在运行的流程。

---

## ✨ 核心功能
* **精准识别**：脚本通过实时侦测鼠标位置自动判断目标显示器，仅操作该区域内的窗口。
* **智能上下文感知 (Context Awareness)**：遵循 Windows 原生逻辑。若当前屏幕有可见窗口，则执行最小化；若已是桌面状态，则执行恢复。
* **多显示器独立记忆**：利用 `Map` 对象为每个物理显示器创建独立的“收纳堆栈”，确保不同屏幕间的操作逻辑互不干扰。
* **焦点记忆**：恢复窗口后，自动重新激活 (Focus) 之前在该屏幕处于活跃状态的窗口。
* **极致兼容性**：深度支持微信 (WeChat)、Discord、VS Code 等采用自定义渲染技术的应用窗口。

---

## 🛠 技术深度：解决“坐标跳跃”陷阱

在多屏开发中，最棘手的问题是**坐标系漂移**。当屏幕 1 的窗口全部最小化后，系统焦点会自动跳转到屏幕 2 的窗口。如果未锁定坐标模式，脚本会产生误判。

### 1. 坐标锁定方案
本项目通过以下全局设置，确保了逻辑的绝对稳定性：
```autohotkey
; 强制所有坐标操作使用全局屏幕坐标，不随活跃窗口改变
CoordMode "Mouse", "Screen"
```
这意味着无论窗口焦点如何跳转，脚本对“鼠标在哪里”以及“窗口在哪里”的判定永远基于物理屏幕的绝对坐标。

### 2. 归属判定算法
脚本通过计算窗口的几何中心点 $P(cX, cY)$ 来判定窗口归属，而非简单的左上角坐标，这有效解决了最大化窗口溢出的问题：

$$cX = wX + \frac{wWidth}{2}$$
$$cY = wY + \frac{wHeight}{2}$$

只有当点 $P$ 落在目标显示器的矩形边界 $[mLeft, mRight] \times [mTop, mBottom]$ 内时，该窗口才会被处理。

---

## ⚠️ 环境要求
* **操作系统**：Windows 10 / 11
* **版本要求**：[AutoHotkey v2.0+](https://www.autohotkey.com/)
    * *注意：本项目利用了 v2.0 的 Map 对象及改进的坐标处理机制，不兼容旧版 v1.1。*

---

## 🚀 快速上手

### 1. 安装与运行
1. 下载本项目中的 `SingleScreenDesktop.ahk` 文件。
2. 确保系统中已安装 AutoHotkey v2 环境。
3. 双击运行脚本，任务栏托盘出现绿色 **H** 图标即表示启动成功。

### 2. 默认快捷键
* **`Alt + D`**：切换当前鼠标所在屏幕的桌面显示或恢复窗口。

### 3. 自定义快捷键
如果需要修改快捷键，请编辑 `.ahk` 文件第一行。例如将 `Alt + D` 改为 `Ctrl + D`：
```autohotkey
^d:: { ; 将 ! 改为 ^
```

---

## 📜 开源协议
本项目基于 **MIT License** 协议开源。